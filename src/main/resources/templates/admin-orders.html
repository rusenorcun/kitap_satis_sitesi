<!doctype html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sipariş Yönetimi • KitapYurdu Admin</title>
    <link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css" />
</head>

<body>
<header class="topbar">
    <div class="container topbar__inner">
        <a class="brand" th:href="@{/}" href="/">
            <span class="brand__mark">KY</span>
            <span class="brand__text">KitapYurdu</span>
        </a>

        <nav class="nav">
            <a class="nav__link" th:href="@{/admin}" href="/admin">Admin Ana Sayfa</a>
            <a class="nav__link" th:href="@{/admin/panel}" href="/admin/panel">Admin Panel</a>
            <a class="nav__link is-active" th:href="@{/admin/siparisler}" href="/admin/siparisler">Siparişler</a>
            <a class="nav__link" th:href="@{/admin/kitap}" href="/admin/kitap">Kitap</a>
            <a class="nav__link" th:href="@{/admin/yayinevi}" href="/admin/yayinevi">Yayınevi</a>
        </nav>

        <div class="topbar__actions">
            <form th:action="@{/logout}" method="post" style="display:inline; margin:0;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit" class="btn btn--ghost">Çıkış</button>
            </form>
            <button class="themeToggle" type="button" data-theme-toggle aria-pressed="false">
                <span class="themeIcon">☀️</span><span class="themeText">Açık</span>
            </button>
        </div>
    </div>
</header>

<main class="container admin">
    <section class="admin__head">
        <div>
            <h1 class="admin__title">Sipariş Yönetimi</h1>
            <p class="admin__subtitle">Aktif siparişleri görüntüle ve durumlarını güncelle.</p>
        </div>
        <div class="admin__headActions">
            <div class="stat-badge">
                <span class="muted">Aktif Sipariş:</span>
                <strong th:text="${aktifSayisi}">0</strong>
            </div>
        </div>
    </section>

    <div class="alert" data-toast="1" th:if="${param.mesaj != null}" th:text="${param.mesaj}"></div>
    <div class="alert alert--err" data-toast="1" th:if="${param.hata != null}" th:text="${param.hata}"></div>

    <section class="card">
        <div class="card__header">
            <h2 class="card__title">Sipariş Listesi</h2>
            <p class="card__desc">Tüm zamanların sipariş kayıtları (Yeniden eskiye).</p>
        </div>

        <div class="card__body">
            <div class="tableWrap">
                <table class="table table--fit">
                    <thead>
                    <tr>
                        <th>#ID</th>
                        <th>Tarih</th>
                        <th>Kullanıcı</th>
                        <th>Ödeme</th>
                        <th class="t-right">Tutar</th>
                        <th>Durum</th>
                        <th class="t-right">İşlem</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="o : ${orders}">
                        <td>
                            <span class="badge" th:text="'#' + ${o.siparisId}">#101</span>
                        </td>
                        <td th:text="${#temporals.format(o.siparisTarihi, 'dd.MM.yyyy HH:mm')}">01.01.2025</td>
                        <td>
                            <div style="font-weight:600" th:text="${o.kullaniciAdi}">User</div>
                        </td>
                        <td class="muted" th:text="${o.odemeYontemi != null ? o.odemeYontemi : '-'}">Kredi Kartı</td>
                        <td class="t-right" style="font-weight:800">
                            <span th:text="${o.genelToplam}">100.00</span> ₺
                        </td>
                        <td>
                            <span class="badge"
                                    th:classappend="${o.siparisDurumu == 'TeslimEdildi' ? 'badge--ok' : 
                                                
                                    (o.siparisDurumu == 'Iptal' ? 'badge--err' : 'badge--warn')}"
                                    th:text="${o.siparisDurumu}">Beklemede</span>
                        </td>
                        <td class="t-right">
                            <form th:action="@{/admin/siparisler/guncelle}" method="post" style="display:flex; align-items:center; justify-content:flex-end; gap:8px;">
                                <input type="hidden" name="siparisId" th:value="${o.siparisId}" />
                                
                                <select name="yeniDurum" class="select select--sm">
                                    <option th:each="st : ${statuses}" 
                                            th:value="${st}" 
                                            th:text="${st}" 
                                            th:selected="${st == o.siparisDurumu}"></option>
                                </select>
                                
                                <button type="submit" class="btn btn--secondary btn--sm">Güncelle</button>
                            </form>
                        </td>
                    </tr>

                    <tr th:if="${#lists.isEmpty(orders)}">
                        <td colspan="7" class="empty">Henüz sipariş bulunmuyor.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</main>

<footer class="footer">
    <div class="container footer__inner">
        <div class="muted">© <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2025</span> KitapYurdu</div>
        <div class="muted">Admin • Siparişler</div>
    </div>
</footer>

<script th:src="@{/js/app.js}" src="/js/app.js"></script>
<script th:src="@{/js/toast.js}" src="/js/toast.js"></script>
<script th:src="@{/js/theme.js}" src="/js/theme.js"></script>

</body>
</html>