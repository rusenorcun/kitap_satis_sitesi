<!doctype html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Kitap Yönetimi • KitapYurdu</title>
	<link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css" />
</head>

<body>
<header class="topbar">
    <div class="container topbar__inner">
        <a class="brand" th:href="@{/}" href="/">
            <span class="brand__mark">KY</span>
            <span class="brand__text">KitapYurdu</span>
        </a>

        <nav class="nav">
            <a class="nav__link" th:href="@{/admin}" href="/admin">Admin Ana Sayfa</a>
            <a class="nav__link" th:href="@{/admin/panel}" href="/admin/panel">Admin Panel</a>
            <a class="nav__link" th:href="@{/admin/siparisler}" href="/admin/siparisler">Siparişler</a>
            <a class="nav__link is-active" th:href="@{/admin/kitap}" href="/admin/kitap">Kitap</a>
            <a class="nav__link" th:href="@{/admin/yayinevi}" href="/admin/yayinevi">Yayınevi</a>
        </nav>

        <div class="topbar__actions">
            <form th:action="@{/logout}" method="post" style="display:inline; margin:0;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit" class="btn btn--ghost">Çıkış</button>
            </form>
            <button class="themeToggle" type="button" data-theme-toggle aria-pressed="false">
                <span class="themeIcon">☀️</span><span class="themeText">Açık</span>
            </button>
        </div>
    </div>
</header>

<main class="container admin">
	<section class="admin__head">
		<div>
			<h1 class="admin__title">Kitap Yönetimi</h1>
			<p class="admin__subtitle">Kitap ekle • güncelle • sil • listele</p>
		</div>

		<div class="admin__headActions">
			<a class="btn btn--secondary" th:href="@{/admin}" href="/admin">Admin Panel</a>
			<a class="btn btn--ghost" th:href="@{/admin/kitap/new}" href="/admin/kitap/new">Yeni Kitap</a>
		</div>
	</section>

	<section class="admin__grid">
		<!-- SOL: Liste -->
		<section class="card">
			<div class="card__header">
				<h2 class="card__title">Kitap Listesi</h2>
				<p class="card__desc">Arama yap, seç ve düzenle.</p>
			</div>

			<div class="card__body">
				<form class="toolbar" th:action="@{/admin/kitap}" method="get">
					<div class="toolbar__left">
						<label class="field field--inline">
							<span class="field__label">Ara</span>
							<input class="input" name="q" type="text" placeholder="Kitap adı..." th:value="${q}" />
						</label>
                        <label class="field field--inline">
                            <span class="field__label">Yayınevi</span>
                            <select class="input" name="yayineviId">
                                <option value="">Hepsi</option>
                                <option th:each="y : ${yayinevleri}"
                                        th:value="${y.id}"
                                        th:text="${y.ad}"
                                        th:selected="${seciliYayineviId != null and seciliYayineviId == y.id}">
                                    Yayinevi
                                </option>
                            </select>
                        </label>

					</div>

					<div class="toolbar__right">
						<button class="btn btn--secondary" type="submit">Filtrele</button>
						<a class="btn btn--ghost" th:href="@{/admin/kitap}" href="/admin/kitap">Sıfırla</a>
					</div>
				</form>

				<div class="tableWrap">
					<table class="table table--fit">
						<thead>
						<tr>
							<th>ID</th>
							<th>Kitap</th>
							<th class="t-right">Fiyat</th>
							<th class="t-right">Stok</th>
							<th>Durum</th>
							<th class="t-right">İşlem</th>
						</tr>
						</thead>
						<tbody>
						<tr th:each="k : ${kitaplar}">
							<td th:text="${k.kitapId}">1</td>
							<td>
								<div class="titleCell">
									<div class="titleCell__main" th:text="${k.kitapAdi}">Kitap</div>
									<div class="titleCell__sub muted"
											th:text="${k.yayineviAdi != null ? k.yayineviAdi : '-'}">Yayınevi</div>
								</div>
							</td>
							<td class="t-right" th:text="${k.fiyat}">0</td>
							<td class="t-right" th:text="${k.stok}">0</td>
							<td>
								<span class="titleCell" th:classappend="${k.durum} ? ' badge--ok' : ' badge--muted'"
											th:text="${k.durum} ? 'Aktif' : 'Pasif'">Aktif</span>
							</td>
							<td class="t-right">
								<div class="rowActions">
									<a class="btn btn--ghost btn--sm"
										th:href="@{/admin/kitap(editId=${k.kitapId}, q=${q}, scroll='stok')}">Düzenle</a>

									<form th:action="@{/admin/kitap/delete}" method="post" class="inline">
										<input type="hidden" name="kitapId" th:value="${k.kitapId}" />
										<button class="btn btn--secondary btn--sm" type="submit">Sil</button>
									</form>
								</div>
							</td>
						</tr>

						<tr th:if="${kitaplar == null || #lists.isEmpty(kitaplar)}">
							<td colspan="6" class="empty">Sonuç bulunamadı.</td>
						</tr>
						</tbody>
					</table>
				</div>

				<p class="hint">
					İpucu: “Düzenle” ile sağ panelde form dolar. Silme, mevcut SP ile çalışır.
				</p>
			</div>
		</section>

		<!-- SAĞ: Ekle / Güncelle -->
		<section class="card">
			<div class="card__header">
				<h2 class="card__title" th:text="${form.kitapId != null ? 'Kitap Güncelle (ID: ' + form.kitapId + ')' : 'Yeni Kitap'}">Yeni Kitap</h2>
				<p class="card__desc">Yayınevini listeden seçerek ekle/güncelle.</p>
			</div>

			<div class="card__body">
				<form class="formGrid" th:action="@{/admin/kitap/save#stok}" method="post">
					<input type="hidden" name="kitapId" th:value="${form.kitapId}" />

					<label class="field">
						<span class="field__label">ISBN (opsiyonel)</span>
						<input class="input" name="isbn" type="text" maxlength="13" th:value="${form.isbn}" placeholder="13 haneli" />
					</label>

					<label class="field">
						<span class="field__label">Kitap Adı</span>
						<input class="input" name="ad" type="text" required th:value="${form.ad}" />
					</label>

					<label class="field">
						<span class="field__label">Yayınevi</span>
						<select class="input" name="yayineviId">
							<option value="">Seçiniz (opsiyonel)</option>
							<option th:each="y : ${yayinevleri}"
											th:value="${y.id}"
											th:text="${y.ad}"
											th:selected="${form.yayineviId != null and form.yayineviId == y.id}">
								Yayınevi
							</option>
						</select>
					</label>

					<label class="field">
						<span class="field__label">Fiyat</span>
						<input class="input" name="fiyat" type="number" step="0.01" min="0" required th:value="${form.fiyat}" />
					</label>

					<label class="field">
						<span class="field__label">Stok</span>
						<input class="input" name="stok" type="number" min="0" required th:value="${form.stok}" />
					</label>

					<label class="field">
						<span class="field__label">Sayfa Sayısı</span>
						<input class="input" name="sayfaSayisi" type="number" min="1" th:value="${form.sayfaSayisi}" />
					</label>

					<label class="field">
						<span class="field__label">Basım Yılı</span>
						<input class="input" name="basimYili" type="number" min="1500" max="2100" th:value="${form.basimYili}" />
					</label>

					<label class="field">
						<span class="field__label">Durum</span>
						<select class="input" name="durum">
							<option th:value="true"  th:selected="${form.durum}">Aktif</option>
							<option th:value="false" th:selected="${!form.durum}">Pasif</option>
						</select>
					</label>

					<label class="field">
						<span class="field__label">Açıklama</span>
						<textarea class="input" name="aciklama" rows="4" th:text="${form.aciklama}"></textarea>
					</label>

					<button class="btn btn--secondary btn--block" type="submit">
						Kaydet
					</button>
				</form>
			</div>
		</section>
	</section>
</main>

<footer class="footer">
	<div class="container footer__inner">
		<div class="muted">© <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2025</span> Ruşen Orçun Koçer</div>
		<div class="muted">Admin • Kitap Yönetimi</div>
	</div>
</footer>
<script th:src="@{/js/app.js}" src="/js/app.js"></script>
<script th:src="@{/js/toast.js}" src="/js/toast.js"></script>
<script th:src="@{/js/theme.js}" src="/js/theme.js"></script>

</body>
</html>
